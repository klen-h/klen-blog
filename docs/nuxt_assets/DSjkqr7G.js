import Z from"./DlX_lPuI.js";import{A as tt,u as et,r as u,p as st,f as O,q as rt,B as nt,c,a as e,b as o,g as P,i,d as _,F as A,j as I,k as h,v as C,m as S,C as N,o as m,n as at,t as E}from"#entry";import{_ as lt}from"./8tPKrylh.js";import{N as ot,d as it}from"./0RxLl8s0.js";import{_ as dt}from"./DlAUqK2U.js";const ut={class:"py-8"},ct={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},mt={class:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 mb-6"},gt={key:0,class:"mb-4 p-3 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-700 rounded-lg"},pt={class:"flex items-center"},yt={class:"flex flex-wrap gap-2 mb-4"},bt={class:"relative"},xt={key:0,class:"absolute top-full left-0 mt-2 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded-lg shadow-lg p-3 z-10"},vt={class:"grid grid-cols-4 gap-2"},wt=["onClick","title"],ft={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"},kt={class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4"},ht={class:"grid grid-cols-1 lg:grid-cols-2 gap-4"},Ct={class:"w-full h-96 p-4 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white overflow-y-auto prose prose-sm max-w-none"},St=["innerHTML"],_t={class:"flex flex-wrap gap-4 mt-6"},$t={class:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6"},Et={class:"overflow-x-auto"},Dt={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700"},Tt={class:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700"},At={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white"},It={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300"},Nt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300"},Vt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300"},Lt={class:"px-6 py-4 whitespace-nowrap text-sm font-medium"},Ut=["onClick"],Rt=["onClick"],qt={__name:"local-editor",setup(Mt){const V=tt();et({title:"本地编辑器 - 我的个人博客"});const y=u(""),g=u(""),v=u(""),w=u(""),f=u(new Date().toISOString().split("T")[0]),a=u(""),D=u([]),$=u(!1),L=!0,j=u([{name:"红色",value:"#ef4444"},{name:"灰色",value:"#6b7280"},{name:"黄色",value:"#eab308"},{name:"绿色",value:"#22c55e"}]),b=u({show:!1,message:"",type:"info"}),z=st(()=>it(a.value||"")),x=(r,t)=>{const n=document.querySelector("textarea"),s=n.selectionStart,l=n.selectionEnd,d=a.value.substring(s,l),p=r+d+t;a.value=a.value.substring(0,s)+p+a.value.substring(l),N(()=>{n.focus(),n.setSelectionRange(s+r.length,s+r.length+d.length)})};u(null);const B=async()=>{try{if(L){k("生产环境不支持图片上传");return}const r=document.createElement("input");r.type="file",r.accept="image/*",r.onchange=async t=>{const n=t.target.files[0];if(n)try{k("正在上传图片...");const s=new FormData;s.append("image",n);const l=await fetch("/api/save-image",{method:"POST",body:s});if(!l.ok){const p=await l.text();throw new Error(p)}const d=await l.json();if(d.success)F(`![${d.originalName}](${d.imagePath})`),q(`图片已保存到 public/images: ${d.imageName}`);else throw new Error("上传失败")}catch(s){console.error("上传失败:",s),T("图片上传失败: "+s.message)}},r.click()}catch(r){console.error("选择文件失败:",r),T("选择文件失败: "+r.message)}},F=r=>{const t=document.querySelector("textarea");document.activeElement!==t&&t.focus();const n=t.selectionStart,s=t.selectionEnd,l=a.value.substring(0,n),d=a.value.substring(s);a.value=l+r+`
`+d,N(()=>{t.focus();const p=n+r.length+1;t.setSelectionRange(p,p)})},H=r=>{const t=document.querySelector("textarea");document.activeElement!==t&&t.focus();const n=t.selectionStart,s=t.selectionEnd,l=a.value.substring(n,s);if(!l){k("请先选中要设置颜色的文字");return}const d=`<span style="color: ${r}">${l}</span>`,p=a.value.substring(0,n),X=a.value.substring(s);a.value=p+d+X,N(()=>{t.focus();const M=n+d.length;t.setSelectionRange(M,M)}),$.value=!1},U=async()=>{{k("生产环境为只读，无法保存文章");return}},R=()=>{if(!g.value){T("请先填写文章别名");return}const r={title:y.value,content:a.value,excerpt:w.value,tags:v.value.split(",").map(t=>t.trim()).filter(t=>t),date:f.value};localStorage.setItem("previewArticle",JSON.stringify(r)),window.open("/preview","_blank")},K=async()=>{{k("生产环境为只读，无法从服务端加载文章");return}},J=()=>{confirm("确定要清空编辑器吗？")&&(y.value="",g.value="",v.value="",w.value="",f.value=new Date().toISOString().split("T")[0],a.value="")},Y=r=>{y.value=r.title,g.value=r.slug,a.value=r.content,w.value=r.excerpt||"",v.value=r.tags.join(", "),f.value=r.date,q("文章加载成功")},G=async r=>{{k("生产环境为只读，无法删除文章");return}},Q=async()=>{try{const r=await $fetch("/api/posts.json");D.value=r}catch{D.value=[]}},q=r=>{b.value={show:!0,message:r,type:"success"}},T=r=>{b.value={show:!0,message:r,type:"error"}},k=r=>{b.value={show:!0,message:r,type:"info"}},W=r=>r?new Date(r).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"}):"";return O(()=>{try{if(!(localStorage.getItem("editorVerified")==="true")){V.replace("/");return}}catch{V.replace("/");return}Q()}),rt(y,r=>{r&&!g.value&&(g.value=r.toLowerCase().replace(/[^\w\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim())}),O(()=>{const r=t=>{t.ctrlKey&&t.key==="s"&&(t.preventDefault(),U()),t.ctrlKey&&t.key==="Enter"&&(t.preventDefault(),R())};document.addEventListener("keydown",r),nt(()=>{document.removeEventListener("keydown",r)})}),(r,t)=>{const n=Z;return m(),c("div",ut,[e("div",ct,[o(lt,{title:"本地编辑器",subtitle:"简单高效的本地文章编辑方案"}),e("div",mt,[i(L)?(m(),c("div",gt,[e("div",pt,[o(n,{name:"lucide:info",class:"w-5 h-5 text-yellow-600 dark:text-yellow-400 mr-2"}),t[15]||(t[15]=e("span",{class:"text-yellow-800 dark:text-yellow-200 text-sm"},[e("strong",null,"生产环境："),_("此编辑器为只读模式，仅用于展示 UI 功能，无法保存或上传文件。 ")],-1))])])):P("",!0),e("div",yt,[e("button",{onClick:t[0]||(t[0]=s=>x("**","**")),class:"btn btn-sm btn-secondary",title:"粗体"},[o(n,{name:"lucide:bold",class:"w-4 h-4"})]),e("button",{onClick:t[1]||(t[1]=s=>x("*","*")),class:"btn btn-sm btn-secondary",title:"斜体"},[o(n,{name:"lucide:italic",class:"w-4 h-4"})]),e("button",{onClick:t[2]||(t[2]=s=>x("### ","")),class:"btn btn-sm btn-secondary",title:"标题"},[o(n,{name:"lucide:heading",class:"w-4 h-4"})]),e("button",{onClick:t[3]||(t[3]=s=>x("- ","")),class:"btn btn-sm btn-secondary",title:"列表"},[o(n,{name:"lucide:list",class:"w-4 h-4"})]),e("button",{onClick:t[4]||(t[4]=s=>x("[","](url)")),class:"btn btn-sm btn-secondary",title:"链接"},[o(n,{name:"lucide:link",class:"w-4 h-4"})]),e("button",{onClick:B,class:"btn btn-sm btn-secondary",title:"插入图片"},[o(n,{name:"lucide:image",class:"w-4 h-4"})]),e("button",{onClick:t[5]||(t[5]=s=>x("```\n","\n```")),class:"btn btn-sm btn-secondary",title:"代码块"},[o(n,{name:"lucide:code",class:"w-4 h-4"})]),e("button",{onClick:t[6]||(t[6]=s=>x("> ","")),class:"btn btn-sm btn-secondary",title:"引用"},[o(n,{name:"lucide:quote",class:"w-4 h-4"})]),e("div",bt,[e("button",{onClick:t[7]||(t[7]=s=>$.value=!i($)),class:"btn btn-sm btn-secondary",title:"文字颜色"},[o(n,{name:"lucide:palette",class:"w-4 h-4"})]),i($)?(m(),c("div",xt,[e("div",vt,[(m(!0),c(A,null,I(i(j),s=>(m(),c("button",{key:s.name,onClick:l=>H(s.value),class:"w-8 h-8 rounded-lg border-2 border-gray-300 dark:border-gray-600 hover:border-primary-500 dark:hover:border-primary-400 transition-colors",style:at({backgroundColor:s.value}),title:s.name},null,12,wt))),128))])])):P("",!0)])]),e("div",ft,[e("div",null,[t[16]||(t[16]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"}," 文章标题 ",-1)),h(e("input",{"onUpdate:modelValue":t[8]||(t[8]=s=>S(y)?y.value=s:null),type:"text",class:"input w-full text-xl font-bold",placeholder:"输入文章标题..."},null,512),[[C,i(y)]])]),e("div",null,[t[17]||(t[17]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"}," 文章别名 (slug) ",-1)),h(e("input",{"onUpdate:modelValue":t[9]||(t[9]=s=>S(g)?g.value=s:null),type:"text",class:"input w-full",placeholder:"文章URL标识..."},null,512),[[C,i(g)]])])]),e("div",kt,[e("div",null,[t[18]||(t[18]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"}," 分类标签 ",-1)),h(e("input",{"onUpdate:modelValue":t[10]||(t[10]=s=>S(v)?v.value=s:null),type:"text",class:"input w-full",placeholder:"技术,学习,生活 (用逗号分隔)"},null,512),[[C,i(v)]])]),e("div",null,[t[19]||(t[19]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"}," 摘要 ",-1)),h(e("input",{"onUpdate:modelValue":t[11]||(t[11]=s=>S(w)?w.value=s:null),type:"text",class:"input w-full text-sm",placeholder:"文章摘要..."},null,512),[[C,i(w)]])]),e("div",null,[t[20]||(t[20]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"}," 发布日期 ",-1)),h(e("input",{"onUpdate:modelValue":t[12]||(t[12]=s=>S(f)?f.value=s:null),type:"date",class:"input w-full"},null,512),[[C,i(f)]])])]),e("div",ht,[e("div",null,[t[21]||(t[21]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Markdown 编辑器 ",-1)),h(e("textarea",{"onUpdate:modelValue":t[13]||(t[13]=s=>S(a)?a.value=s:null),class:"w-full h-96 p-4 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white resize-none focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"开始写作..."},null,512),[[C,i(a)]])]),e("div",null,[t[22]||(t[22]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," 预览 ",-1)),e("div",Ct,[e("div",{innerHTML:i(z)},null,8,St)])])]),e("div",_t,[e("button",{onClick:U,class:"btn btn-primary"},[o(n,{name:"lucide:save",class:"w-4 h-4 mr-2"}),t[23]||(t[23]=_(" 保存文章 ",-1))]),e("button",{onClick:R,class:"btn btn-secondary"},[o(n,{name:"lucide:eye",class:"w-4 h-4 mr-2"}),t[24]||(t[24]=_(" 预览文章 ",-1))]),e("button",{onClick:K,class:"btn btn-secondary"},[o(n,{name:"lucide:folder-open",class:"w-4 h-4 mr-2"}),t[25]||(t[25]=_(" 加载文章 ",-1))]),e("button",{onClick:J,class:"btn btn-outline"},[o(n,{name:"lucide:trash-2",class:"w-4 h-4 mr-2"}),t[26]||(t[26]=_(" 清空编辑器 ",-1))])])]),e("div",$t,[t[28]||(t[28]=e("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white mb-4"}," 本地文章列表 ",-1)),e("div",Et,[e("table",Dt,[t[27]||(t[27]=e("thead",{class:"bg-gray-50 dark:bg-gray-700"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"}," 标题 "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"}," 别名 "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"}," 标签 "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"}," 日期 "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"}," 操作 ")])],-1)),e("tbody",Tt,[(m(!0),c(A,null,I(i(D),s=>(m(),c("tr",{key:s.slug},[e("td",At,E(s.title),1),e("td",It,E(s.slug),1),e("td",Nt,[(m(!0),c(A,null,I(s.tags,l=>(m(),c("span",{key:l,class:"inline-block bg-gray-100 dark:bg-gray-600 text-gray-800 dark:text-gray-200 rounded-full px-2 py-1 text-xs mr-1"},E(l),1))),128))]),e("td",Vt,E(W(s.date)),1),e("td",Lt,[e("button",{onClick:l=>Y(s),class:"text-primary-600 hover:text-primary-900 dark:text-primary-400 dark:hover:text-primary-300 mr-3"}," 编辑 ",8,Ut),e("button",{onClick:l=>G(s.slug),class:"text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300"}," 删除 ",8,Rt)])]))),128))])])])])]),o(ot,{show:i(b).show,message:i(b).message,type:i(b).type,onClose:t[14]||(t[14]=s=>i(b).show=!1)},null,8,["show","message","type"])])}}},Ft=dt(qt,[["__scopeId","data-v-3721639f"]]);export{Ft as default};
